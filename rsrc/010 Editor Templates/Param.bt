//--------------------------------------
//--- 010 Editor v5.0 Binary Template
//
// File: Dark Souls .PARAM (Parameter File)
// Author: Jed "Nyxojaele" Lang
// Other contributors: Sean Pesce
// Revision: 1
//--------------------------------------
#ifndef _DS1_PARAM_BT
    #define _DS1_PARAM_BT

#include "Utility.bt"

typedef struct(int dataSize)
{
    int Id <format=hex>;

    int DataOffset <format=hex>;
    if (DataOffset == 0)
        Printf("Null pointer for DataOffset!\n");
    else
    {
        local long oldPos = FTell();
        FSeek(DataOffset);
        char Data[dataSize];
        FSeek(oldPos);
    }

    int NameOffset <format=hex>;
    if (NameOffset != 0)
    {
        oldPos = FTell();
        FSeek(NameOffset);
        string Name <bgcolor=0xBB9900, read=str_to_shift_jis>;
        FSeek(oldPos);
    }
} RowStruct <read=ReadRowStruct>;
wstring ReadRowStruct(RowStruct &rs)
{
    if (exists(rs.Name))
    {
        string ret;
        SPrintf(ret, "%d: ", rs.Id);
        wstring wret = StringToWString(ret) + str_to_shift_jis(rs.Name);
        return wret;
    }
    else
        return L"<empty>";
}

int StringsOffset <format=hex>;
short FirstRowDataOffset <format=hex>;
short Unknown1[2];
short RowCount;
char Name[0x20];
int Unknown2;

local int dataSize = (StringsOffset - FirstRowDataOffset)/RowCount;
struct
{
    RowStruct Row(dataSize)[RowCount] <optimize=false>;
} Rows;

#endif // _DS1_PARAM_BT